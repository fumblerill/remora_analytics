{% extends "base.html" %}
{% block title %}–ê–Ω–∞–ª–∏–∑ –≤—ã–≥—Ä—É–∑–∫–∏ –°–≠–ú–î{% endblock %}

{% block content %}

{# –ü—Ä–µ–ª–æ–∞–¥–µ—Ä ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö #}
{% if filename %}
  <div id="preloader" class="d-flex justify-content-center align-items-center" style="height: 80vh;">
    <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
      <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
  </div>
{% endif %}

{# –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ #}
{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}

{# –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞ #}
{% if not filename %}
  <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <h2 class="text-primary text-center">–ó–∞–≥—Ä—É–∑–∏—Ç–µ .xlsx —Ñ–∞–π–ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É</h2>
  </div>
{% endif %}

{# –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ #}
{% if filename %}
  <div id="content-wrapper" style="display: none; opacity: 0; transition: opacity 0.3s;">
    <h2 class="mb-4">–ê–Ω–∞–ª–∏–∑ –≤—ã–≥—Ä—É–∑–∫–∏ –°–≠–ú–î</h2>

    <!-- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –í—Ä–∞—á–∏ > 500 -->
    <div class="row mb-4">
      <div class="col-md-6 section" id="statistics">
        <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –°–≠–ú–î –≤ –†–≠–ú–î</h5>
        {{ tables.statistics | safe }}
      </div>
      <div class="col-md-6 section" id="doc_perf_500">
        <h5>üë®‚Äç‚öïÔ∏è –í—Ä–∞—á–∏, –≤—ã–ø–æ–ª–Ω–∏–≤—à–∏–µ > 500 –°–≠–ú–î</h5>
        {{ tables.doc_perf_500 | safe }}
      </div>
    </div>

    <!-- üü£ –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ -->
    <div class="section mb-4" id="pie">
      <h5>üü£ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –°–≠–ú–î –≤ –†–≠–ú–î</h5>
      <div class="d-flex justify-content-center">
        <div style="width: 100%; max-width: 800px; display: flex; align-items: center;">
          <canvas id="pieChart"></canvas>
        </div>
      </div>
    </div>

    <!-- üìâ –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ -->
    <div class="section mb-5" id="bar">
      <h5>üìâ –û—à–∏–±–∫–∏ –°–≠–ú–î –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –†–≠–ú–î</h5>
      <div class="d-flex justify-content-center">
        <div style="width: 100%; max-width: 900px; height: 500px; display: flex; justify-content: center; margin-top: 40px; margin-bottom: 40px;">
          <canvas id="barChart"></canvas>
        </div>
      </div>
    </div>

    <!-- üìë –í–∏–¥—ã –°–≠–ú–î –∏ –æ—à–∏–±–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ -->
    <div class="row mb-4">
      <div class="col-md-6 section" id="types">
        <h5>üìë –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–∏–¥–∞–º –°–≠–ú–î</h5>
        {{ tables.types | safe }}
      </div>
      <div class="col-md-6 section" id="cert_errors">
        <h5>üîê –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h5>
        {{ tables.cert_errors | safe }}
      </div>
    </div>

    <!-- üìã –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    <div class="section" id="raw">
      <h5>üìã –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h5>
      {% if tables and tables.raw %}
        <details>
          <summary class="btn btn-outline-primary">üìÇ –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</summary>
          {{ tables.raw | safe }}
        </details>
      {% else %}
        <p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</em></p>
      {% endif %}
    </div>

    <!-- üìñ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ—à–∏–±–æ–∫ -->
    <div class="section" id="reference">
      <h5>üìñ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ—à–∏–±–æ–∫</h5>
      <details>
        <summary class="btn btn-outline-secondary">üîç –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</summary>
        {{ tables.reference | safe }}
      </details>
    </div>
  </div>
{% endif %}

{% block scripts %}
<!-- –í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
<script src="{{ url_for('static', path='js/upload.js') }}"></script>

<!-- –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º -->
<script>
  const barLabels = {{ bar_labels | default([]) | tojson }};
  const barValues = {{ bar_values | default([]) | tojson }};
  const pieLabels = {{ pie_labels | default([]) | tojson }};
  const pieValues = {{ pie_values | default([]) | tojson }};
</script>
{% endblock %}
{% endblock %}